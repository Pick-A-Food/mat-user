<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:th="http://www.thymeleaf.org"
      layout:decorate="~{layout/basic.html}">
<head>
    <meta charset="UTF-8">
    <title>Vision UI</title>
</head>
<body>

<div layout:fragment="content">
    <h1>Google Vision API Use</h1>
    <form class="imageForm" action="/vision/detectText" method="get">
        <input type="file" accept="image/*" required name="imageFile"/>
        <input type="hidden" name="imageBase64"/>
        <button>Submit</button>
    </form>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</div>

<script layout:fragment="script" th:inline="javascript">
  async function uploadToServer (file) {
    const response = await axios({
      method: 'get',
      url: '/vision/detectText',
      data: [file],
      headers: {
        'Content-Type': 'multipart/form-data',
      },
    });

    return response.data
  }

  const imageForm = document.querySelector(".imageForm");
  imageForm.addEventListener("submit", (e) => {
    e.preventDefault();
    e.stopPropagation();

    let files = imageForm.querySelector('input[name="imageFile"]').files;
    if (files === null || files.length === 0) {
      return;
    }
    let file = imageForm.querySelector('input[name="imageFile"]').files[0];
    console.log(file)
    console.log(files)

    uploadToServer(file)

  }, false);


</script>

</body>
</html>