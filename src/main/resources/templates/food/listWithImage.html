<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/basic.html}">

<div layout:fragment="content">
    <form class="imageUploadForm" th:action="@{/vision/detectText}" th:object="${uploadFileDTO}" method="post">
        <input type="file" name="files"/>
        <button>검색하기</button>
    </form>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="/js/vision_api.js"></script>
</div>


<script layout:fragment="script" th:inline="javascript">
    const imageUploadForm = document.querySelector(".imageUploadForm");

    imageUploadForm.querySelector("button").addEventListener("click", (e) => {
      e.stopPropagation();
      e.preventDefault();
      const formObj = new FormData();
      const fileInput = document.querySelector("input[name='files']");
      console.log(fileInput.files);
      const files = fileInput.files;
      for (let i = 0; i < files.length; i++) {
        formObj.append("files", files[i]);
      }
      visionAPI.detectText(formObj).then(data => {
        let list = data["list"]
        list = list.map(element => {
          return element.replace(/[\])}[{(]/g, '');
        });
        list = list.filter(element => element !== '');
        console.log(list);
      })
    }, false);

</script>
